<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SpaTopic Basics â€¢ SpaTopic</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SpaTopic Basics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpaTopic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SpaTopic.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Analysis_for_3Dimage.html">Analysis for 3D image</a></li>
    <li><a class="dropdown-item" href="../articles/Intro_SpaTopic.html">SpaTopic Basics</a></li>
    <li><a class="dropdown-item" href="../articles/Model_Selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="../articles/spleen_analysis.html">Analysis across Multiple Images</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/xiyupeng/SpaTopic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>SpaTopic Basics</h1>
                        <h4 data-toc-skip class="author">Xiyu Peng</h4>
            
            <h4 data-toc-skip class="date">2025-02-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/xiyupeng/SpaTopic/blob/HEAD/vignettes/Intro_SpaTopic.Rmd"><code>vignettes/Intro_SpaTopic.Rmd</code></a></small>
      <div class="d-none name"><code>Intro_SpaTopic.Rmd</code></div>
    </div>

    
    
<p>**More detailed documentation is available at the <a href="https://xiyupeng.github.io/SpaTopic/" class="external-link">SpaTopic Home Page</a>.
Please check the <a href="https://github.com/xiyupeng/SpaTopic">github
page</a> for more detailed information for the package.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Recent advancements in multiplexed tissue imaging allow for
examination of tissue microenvironments in great detail. These
cutting-edge technologies offer invaluable insights into cellular
heterogeneity and spatial architectures, playing a crucial role in
decoding mechanisms of treatment response and disease progression.</p>
<p>However, gaining a deep understanding of complex spatial patterns
remains challenging. <code>SpaTopic</code> implements a novel spatial
topic model to integrate both cell type and spatial information to
identify the complex spatial tissue structures without human
intervention. The Collapsed Gibbs sampling algorithm is used for model
inference. Contrasting to computationally intensive
K-nearest-neighbor-based cell neighborhood analysis approaches,
<code>SpaTopic</code> is more scalable to large-scale image datasets
without extracting neighborhood information for every single cell.</p>
<p><code>SpaTopic</code> can be applied either on a single image or
across multiple images.</p>
</div>
<div class="section level2">
<h2 id="simple-usage">Simple Usage<a class="anchor" aria-label="anchor" href="#simple-usage"></a>
</h2>
<p>The required input of SpaTopic is a data frame containing cells
within on a single image or a list of data frames for multiple images.
Each data frame consists of four columns:</p>
<ul>
<li>image: Image ID</li>
<li>X, Y: X, Y cell coordinate</li>
<li>type: cell type information</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xiyupeng/SpaTopic">SpaTopic</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"SpaTopic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '1.2.0.9000'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">## The input can be a data frame or a list of data frames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lung5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lung5</span><span class="op">)</span></span>
<span><span class="co">#&gt;      image        X        Y           type</span></span>
<span><span class="co">#&gt; 1_1 image1 4215.889 158847.7      Dendritic</span></span>
<span><span class="co">#&gt; 2_1 image1 6092.889 158834.7     Macrophage</span></span>
<span><span class="co">#&gt; 3_1 image1 7214.889 158843.7 Neuroendocrine</span></span>
<span><span class="co">#&gt; 4_1 image1 7418.889 158813.7     Macrophage</span></span>
<span><span class="co">#&gt; 5_1 image1 7446.889 158845.7     Macrophage</span></span>
<span><span class="co">#&gt; 6_1 image1 3254.889 158838.7          CD4 T</span></span></code></pre></div>
<p>Run Gibbs Sampling</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Gibbs sampling</span></span>
<span><span class="va">gibbs.res</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/SpaTopic_inference.html">SpaTopic_inference</a></span><span class="op">(</span><span class="va">lung5</span>, ntopics <span class="op">=</span> <span class="fl">7</span>, sigma <span class="op">=</span> <span class="fl">50</span>, region_radius <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></code></pre></div>
<p>Check the output of SpaTopic</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gibbs.res</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpaTopic Results</span></span>
<span><span class="co">#&gt; ----------------</span></span>
<span><span class="co">#&gt; Number of topics: 7 </span></span>
<span><span class="co">#&gt; Perplexity: 11.31563 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Topic Content(Topic distribution across cell types):</span></span>
<span><span class="co">#&gt;                                 topic1       topic2       topic3      topic4</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 1 0.035870295 6.511503e-03 4.541367e-06 0.026643327</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 2 0.025386476 3.553900e-02 4.541367e-06 0.017427665</span></span>
<span><span class="co">#&gt; Artery                     0.007545591 2.624548e-06 9.128148e-04 0.001856373</span></span>
<span><span class="co">#&gt; B                          0.018581190 5.800251e-04 3.446035e-01 0.015203195</span></span>
<span><span class="co">#&gt; Basal                      0.025846292 7.753466e-01 1.730261e-03 0.089193312</span></span>
<span><span class="co">#&gt;                                  topic5       topic6      topic7</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 1 2.987411e-06 6.348481e-06 0.005341969</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 2 2.987411e-06 6.348481e-06 0.006994451</span></span>
<span><span class="co">#&gt; Artery                     5.320579e-03 2.044846e-02 0.006041096</span></span>
<span><span class="co">#&gt; B                          1.912242e-02 3.434528e-03 0.018434717</span></span>
<span><span class="co">#&gt; Basal                      4.902342e-03 6.348481e-06 0.006549552</span></span>
<span><span class="co">#&gt; ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use $Z.trace for posterior probabilities of topic assignments for each cell</span></span>
<span><span class="co">#&gt; Use $cell_topics for final topic assignments for each cell</span></span>
<span><span class="co">#&gt; Use $parameters for accessing model parameters</span></span></code></pre></div>
<p>For more detailed usage of SpaTopic and how to interprete output from
SpaTopic, please check the complete tutorial in <a href="https://xiyupeng.github.io/SpaTopic/" class="external-link">SpaTopic Home Page</a>. We
also provide a function to prepare input from Seurat v5 object.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xiyu Peng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
