<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Topic Inference to Identify Tissue Architecture in Multiplexed Images • SpaTopic</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Topic Inference to Identify Tissue Architecture in Multiplexed Images">
<meta name="description" content="Also called SpatialTopic. A novel spatial topic model to integrate both cell type and spatial information to identify the complex spatial tissue architecture on multiplexed tissue images without human intervention. The Package implements a collapsed Gibbs sampling algorithm for inference. SpaTopic (SpatialTopic) is highly scalable to large-scale image datasets without extracting neighborhood information for every single cell. For more details on the methodology, see &lt;https://xiyupeng.github.io/SpaTopic/&gt;.">
<meta property="og:description" content="Also called SpatialTopic. A novel spatial topic model to integrate both cell type and spatial information to identify the complex spatial tissue architecture on multiplexed tissue images without human intervention. The Package implements a collapsed Gibbs sampling algorithm for inference. SpaTopic (SpatialTopic) is highly scalable to large-scale image datasets without extracting neighborhood information for every single cell. For more details on the methodology, see &lt;https://xiyupeng.github.io/SpaTopic/&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">SpaTopic</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/SpaTopic.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Analysis_for_3Dimage.html">Analysis for 3D image</a></li>
    <li><a class="dropdown-item" href="articles/Intro_SpaTopic.html">SpaTopic Basics</a></li>
    <li><a class="dropdown-item" href="articles/Model_Selection.html">Model Selection</a></li>
    <li><a class="dropdown-item" href="articles/spleen_analysis.html">Analysis across Multiple Images</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/xiyupeng/SpaTopic/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="spatopic-spatialtopic">SpaTopic (SpatialTopic)<a class="anchor" aria-label="anchor" href="#spatopic-spatialtopic"></a>
</h1></div>
<p><!-- badges: start --> <a href="https://github.com/xiyupeng/SpaTopic/actions/workflows/R-CMD-check.yaml"><img src="https://github.com/xiyupeng/SpaTopic/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://cran.r-project.org/package=SpaTopic" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/SpaTopic"></a> <a href="https://cran.r-project.org/package=SpaTopic" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/SpaTopic"></a> <!-- badges: end --></p>
<p>An R package for fast topic inference to identify tissue architecture in multiplexed images. It implements a <strong>novel spatial topic model</strong> to identify highly interpretable immunologic topics across <strong>multiple</strong> multiplexed images, simply given the cell location and cell type information as input.</p>
<p>In the R package, we adapt an approach originally developed for image segmentation in computer vision, incorporating spatial information into the flexible design of regions (image partitions, analogous to documents in language modeling). We further refined the approach to address unique challenges in cellular images and provide an efficient C++ implementation of the algorithm in this R package.</p>
<p>Compared to other KNN-based methods (such as KNN-kmeans, the default neighborhood analysis in Seurat v5 R package), SpaTopic runs much faster on large-scale image dataset with minimal memory usage. For example, when working on Nanostring CosMx NSCLC dataset, SpaTopic can spatially cluster <strong>0.1 million</strong> of cells on a single image within <strong>1 min</strong> on a regular Mac Air (See <a href="https://xiyupeng.github.io/SpaTopic/articles/SpaTopic.html" class="external-link">tutorial</a>).</p>
<p><strong>News: SpatialTopic now has been published in Nature Communications</strong>:</p>
<p>Peng, X., Smithy, J.W., Yosofvand, M. et al. Scalable topic modelling decodes spatial tissue architecture for large-scale multiplexed imaging analysis. Nat Commun 16, 6619 (2025). <a href="https://doi.org/10.1038/s41467-025-61821-y" class="external-link uri">https://doi.org/10.1038/s41467-025-61821-y</a></p>
<p><strong>Tutorial available to get start it</strong></p>
<p><a href="https://xiyupeng.github.io/SpaTopic/articles/SpaTopic.html" class="external-link uri">https://xiyupeng.github.io/SpaTopic/articles/SpaTopic.html</a></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The R package <code>SpaTopic</code> now is available in CRAN and can be installed with the following code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"SpaTopic"</span><span class="op">)</span></span></code></pre></div>
<p>The development version of <code>SpaTopic</code> can be installed from the <a href="https://github.com/xiyupeng/SpaTopic">GitHub repository</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"xiyupeng/SpaTopic"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dependency">Dependency<a class="anchor" aria-label="anchor" href="#dependency"></a>
</h2>
<p>SpaTopic requires dependency on the following R packages:</p>
<ul>
<li>
<a href="https://cran.r-project.org/package=Rcpp" class="external-link">Rcpp</a> for C++ codes</li>
<li>
<a href="https://cran.r-project.org/package=RcppProgress" class="external-link">RcppProgress</a> for C++ codes</li>
<li>
<a href="https://cran.r-project.org/package=RcppArmadillo" class="external-link">RcppArmadillo</a> for C++ codes</li>
<li>
<a href="https://cran.r-project.org/package=RANN" class="external-link">RANN</a> for fast KNN</li>
<li>
<a href="https://cran.r-project.org/package=foreach" class="external-link">foreach</a> for parallel computing</li>
<li>
<a href="https://cran.r-project.org/package=sf" class="external-link">sf</a> for spatial analysis</li>
</ul>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The required input of SpaTopic is a data frame containing cells within on a single image or a list of data frames for multiple images. Each data frame consists of four columns: The image ID, X, Y cell coordinates, and cell type information.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xiyupeng/SpaTopic">SpaTopic</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"SpaTopic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '1.2.0'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">## The input can be a data frame or a list of data frames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lung5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lung5</span><span class="op">)</span></span>
<span><span class="co">#     image        X        Y           type</span></span>
<span><span class="co">#1_1 image1 4215.889 158847.7      Dendritic</span></span>
<span><span class="co">#2_1 image1 6092.889 158834.7     Macrophage</span></span>
<span><span class="co">#3_1 image1 7214.889 158843.7 Neuroendocrine</span></span>
<span><span class="co">#4_1 image1 7418.889 158813.7     Macrophage</span></span>
<span><span class="co">#5_1 image1 7446.889 158845.7     Macrophage</span></span>
<span><span class="co">#6_1 image1 3254.889 158838.7          CD4 T</span></span>
<span><span class="va">gibbs.res</span><span class="op">&lt;-</span><span class="fu"><a href="reference/SpaTopic_inference.html">SpaTopic_inference</a></span><span class="op">(</span><span class="va">lung5</span>, ntopics <span class="op">=</span> <span class="fl">7</span>, sigma <span class="op">=</span> <span class="fl">50</span>, region_radius <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gibbs.res</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpaTopic Results</span></span>
<span><span class="co">#&gt; ----------------</span></span>
<span><span class="co">#&gt; Number of topics: 7</span></span>
<span><span class="co">#&gt; Perplexity: 11.31563</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Topic Content(Topic distribution across cell types):</span></span>
<span><span class="co">#&gt;                                 topic1       topic2       topic3      topic4</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 1 0.035870295 6.511503e-03 4.541367e-06 0.026643327</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 2 0.025386476 3.553900e-02 4.541367e-06 0.017427665</span></span>
<span><span class="co">#&gt; Artery                     0.007545591 2.624548e-06 9.128148e-04 0.001856373</span></span>
<span><span class="co">#&gt; B                          0.018581190 5.800251e-04 3.446035e-01 0.015203195</span></span>
<span><span class="co">#&gt; Basal                      0.025846292 7.753466e-01 1.730261e-03 0.089193312</span></span>
<span><span class="co">#&gt;                                  topic5       topic6      topic7</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 1 2.987411e-06 6.348481e-06 0.005341969</span></span>
<span><span class="co">#&gt; Alveolar Epithelial Type 2 2.987411e-06 6.348481e-06 0.006994451</span></span>
<span><span class="co">#&gt; Artery                     5.320579e-03 2.044846e-02 0.006041096</span></span>
<span><span class="co">#&gt; B                          1.912242e-02 3.434528e-03 0.018434717</span></span>
<span><span class="co">#&gt; Basal                      4.902342e-03 6.348481e-06 0.006549552</span></span>
<span><span class="co">#&gt; ...</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Use $Z.trace for posterior probabilities of topic assignments for each cell</span></span>
<span><span class="co">#&gt; Use $cell_topics for final topic assignments for each cell</span></span>
<span><span class="co">#&gt; Use $parameters for accessing model parameters</span></span></code></pre>
<p>For detailed usage of SpaTopic, please check:</p>
<ul>
<li>The home page for the tutorial is available <a href="https://xiyupeng.github.io/SpaTopic/" class="external-link">here</a>.</li>
<li>A step-by-step tutorial to reproduce the result on Cosmx lung cancer sample is available <a href="https://xiyupeng.github.io/SpaTopic/articles/SpaTopic.html" class="external-link">here</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The example image used in the tutorial can be downloaded from <a href="https://drive.google.com/drive/folders/1_mJUjzQXWgUZlwUaLq0HKxX-aqgiQ8eD?usp=sharing" class="external-link">here</a>. It is stored in a Seurat v5 object.</p>
</div>
<div class="section level2">
<h2 id="example-output">Example Output<a class="anchor" aria-label="anchor" href="#example-output"></a>
</h2>
<p>The algorithm generates two key statistics for further analysis:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>topic content, a spatially-resolved topic distribution over cell types, and</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>topic assignment for each cell within images.</li>
</ol></li>
</ul>
<strong>Topic Spatial Distribution over images</strong>
<div>
<p><img src="https://github.com/user-attachments/assets/0f116b96-6afc-473a-acbf-8137bdf54c2f" width="500" height="600"></p>
</div>
<strong>Topic Content</strong>
<div>
<p><img src="https://github.com/user-attachments/assets/c80dc4b3-5388-409a-8fa1-f3c975627771" width="600" height="300"></p>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>Peng, X., Smithy, J.W., Yosofvand, M. et al. Scalable topic modelling decodes spatial tissue architecture for large-scale multiplexed imaging analysis. Nat Commun 16, 6619 (2025). <a href="https://doi.org/10.1038/s41467-025-61821-y" class="external-link uri">https://doi.org/10.1038/s41467-025-61821-y</a></p>
<p>Preprint: Xiyu Peng, James W. Smithy, Mohammad Yosofvand, Caroline E. Kostrzewa, MaryLena Bleile, Fiona D. Ehrich, Jasme Lee, Michael A. Postow, Margaret K. Callahan, Katherine S. Panageas, Ronglai Shen. Decoding Spatial Tissue Architecture: A Scalable Bayesian Topic Model for Multiplexed Imaging Analysis. bioRxiv. doi: <a href="https://doi.org/10.1101/2024.10.08.617293" class="external-link uri">https://doi.org/10.1101/2024.10.08.617293</a></p>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>If you have any problems, please contact:</p>
<p>Xiyu Peng (<a href="mailto:pansypeng124@gmail.com" class="email">pansypeng124@gmail.com</a>, <a href="mailto:pengx@stat.tamu.edu" class="email">pengx@stat.tamu.edu</a>)</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=SpaTopic" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/xiyupeng/SpaTopic/">Browse source code</a></li>
<li><a href="https://github.com/xiyupeng/SpaTopic/issues">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SpaTopic</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Xiyu Peng <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4232-0910" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xiyu Peng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
